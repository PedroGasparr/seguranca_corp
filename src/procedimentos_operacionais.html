<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procedimentos Operacionais</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="icon" href="../img/engenheiro.png" type="image/x-icon">
    <link rel="stylesheet" href="../css/procedimentos_op.css">
    <style>
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        .status-pendente {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-aprovado {
            background-color: #d4edda;
            color: #155724;
        }
        .status-rejeitado {
            background-color: #f8d7da;
            color: #721c24;
        }
        .observacoes-box {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        .document-actions-review {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .review-section {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
        }
        .revision-history {
            font-size: 0.85rem;
            color: #6c757d;
        }
        /* Estilos para contadores no menu */
        .menu-badge {
            position: absolute;
            right: 20px;
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .menu-badge-warning {
            background-color: #ffc107;
            color: #000;
        }
        .menu-item-with-badge {
            position: relative;
        }
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        .dashboard-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        .dashboard-card .count {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .card-aprovados {
            border-top: 4px solid #28a745;
        }
        .card-pendentes-1 {
            border-top: 4px solid #ffc107;
        }
        .card-pendentes-final {
            border-top: 4px solid #fd7e14;
        }
        .card-rejeitados {
            border-top: 4px solid #dc3545;
        }
        .stats-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .progress-bar-custom {
            height: 8px;
            border-radius: 4px;
        }
        .document-version {
            font-size: 0.8rem;
            color: #6c757d;
            background-color: #f8f9fa;
            padding: 2px 8px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .document-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Hamburger Menu Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Overlay para mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="app-container">
        <!-- Menu Lateral -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <i class="fas fa-user-circle user-avatar"></i>
                    <div class="user-info">
                        <span class="user-name" id="sidebar-user-name"></span>
                        <span class="user-unit" id="sidebar-user-unit"></span>
                    </div>
                </div>
            </div>

            <nav class="sidebar-menu">
                <ul>
                    <li>
                        <a href="home.html">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li>
                        <a href="edit-user.html">
                            <i class="fas fa-user"></i>
                            <span>Usuário</span>
                        </a>
                    </li>
                    <li>
                        <a href="old_home.html">
                            <i class="fas fa-gauge"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="documentos.html">
                            <i class="fas fa-file-alt"></i>
                            <span>Documentos</span>
                        </a>
                    </li>
                    <li>
                        <a href="validades.html">
                            <i class="fas fa-calendar-check"></i>
                            <span>Validades</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="procedimentos_operacionais.html">
                            <i class="fas fa-book"></i>
                            <span>Procedimentos Operacionais</span>
                        </a>
                    </li>
                    <li>
                        <a href="comunicaçao_ocorrencia.html">
                            <i class="fas fa-bullhorn"></i>
                            <span>Comunicação de Ocorrencia</span>
                        </a>
                    </li>
                    <li>
                        <a href="invetigacao.html">
                            <i class="fas fa-search"></i>
                            <span>Investigação de Ocorrencia</span>
                        </a>
                    </li>
                    <li>
                        <a href="padrinho.html">
                            <i class="fas fa-handshake"></i>
                            <span>Cadastro de Apadrinhamento</span>
                        </a>
                    </li>
                    <li>
                        <a href="Controle_padrinho.html">
                            <i class="fas fa-face-smile"></i>
                            <span>Visualização de Apadrinhamento</span>
                        </a>
                    </li>
                    <li>
                        <a href="visualizar-padrinhos.html">
                            <i class="fas fa-qrcode"></i>
                            <span>Leitor QR Code</span>
                        </a>
                    </li>
                    <li>
                        <a href="google_forms.html">
                            <i class="fab fa-google"></i>
                            <span>Formulários Google</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <button class="btn btn-danger btn-sm w-100" id="sidebar-logout-btn">
                    <i class="fas fa-sign-out-alt"></i> <span class="logout-text">Sair</span>
                </button>
            </div>
        </aside>

        <!-- Conteúdo Principal -->
        <main class="main-content">
            <div class="content-header">
                <h1><i class="fas fa-book me-2"></i>Procedimentos Operacionais</h1>
                <div class="breadcrumb">Gestão de documentos e procedimentos</div>
            </div>

            <!-- Dashboard de Estatísticas -->
            <div class="dashboard-cards fade-in">
                <div class="dashboard-card card-aprovados">
                    <i class="fas fa-check-circle text-success"></i>
                    <h5>Documentos Aprovados</h5>
                    <div class="count" id="count-aprovados">0</div>
                    <p>Total de documentos publicados</p>
                </div>
                
                <div class="dashboard-card card-pendentes-1">
                    <i class="fas fa-clock text-warning"></i>
                    <h5>Pendentes Aprovador 1</h5>
                    <div class="count" id="count-pendentes-1">0</div>
                    <p>Aguardando primeira revisão</p>
                </div>
                
                <div class="dashboard-card card-pendentes-final">
                    <i class="fas fa-user-shield text-info"></i>
                    <h5>Pendentes Aprovador Final</h5>
                    <div class="count" id="count-pendentes-final">0</div>
                    <p>Aguardando aprovação final</p>
                </div>
                
                <div class="dashboard-card card-rejeitados">
                    <i class="fas fa-times-circle text-danger"></i>
                    <h5>Documentos Rejeitados</h5>
                    <div class="count" id="count-rejeitados">0</div>
                    <p>Total de documentos rejeitados</p>
                </div>
            </div>

            <!-- Seção de Upload (visível apenas para gestão corp) -->
            <div id="upload-section" class="upload-section fade-in" style="display: none;">
                <div class="card">
                    <div class="card-header bg-white text-white">
                        <h4 class="mb-0"><i class="fas fa-upload me-2"></i>Enviar Novo Documento para Aprovação</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Após o upload, o documento será enviado para o Aprovador 1 para revisão inicial.
                        </div>
                        <form id="upload-form" class="upload-form">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="document-title" class="form-label">Título do Documento *</label>
                                        <input type="text" class="form-control" id="document-title" required
                                            placeholder="Digite o título do documento">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="document-group" class="form-label">Grupo *</label>
                                        <select class="form-control" id="document-group" required>
                                            <option value="">Selecione um grupo</option>
                                            <option value="GESTÃO CORPORATIVA">GESTÃO CORPORATIVA</option>
                                            <option value="SUZANO UNBC">SUZANO UNBC</option>
                                            <option value="SUZANO UNPE">SUZANO UNPE</option>
                                            <option value="SAINT GOBAIN">SAINT GOBAIN</option>
                                            <option value="JOHN DEERE">JOHN DEERE</option>
                                            <option value="OUTROS">OUTROS</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="document-subgroup-upload" class="form-label">Subgrupo *</label>
                                        <select class="form-control" id="document-subgroup-upload" required>
                                            <option value="">Selecione um subgrupo</option>
                                            <!-- Subgrupos serão carregados dinamicamente -->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mb-3">
                                        <label for="document-file" class="form-label">Arquivo PDF *</label>
                                        <input type="file" class="form-control" id="document-file" required
                                            accept=".pdf">
                                        <div class="form-text">Formato aceito: PDF (Máx: 10MB)</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group mb-3">
                                        <label for="document-observations" class="form-label">Observações (opcional)</label>
                                        <textarea class="form-control" id="document-observations" 
                                            rows="3" placeholder="Informações adicionais sobre o documento..."></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="progress mb-3" style="display: none;" id="upload-progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                    role="progressbar" style="width: 0%"></div>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="form-text">
                                    <i class="fas fa-exclamation-circle me-1"></i>
                                    Todos os campos marcados com * são obrigatórios
                                </div>
                                <button type="submit" class="btn btn-primary btn-lg" id="upload-btn">
                                    <i class="fas fa-upload me-2"></i>Enviar para Aprovação
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Lista de Documentos -->
            <div class="filter-section fade-in mt-4">
                <div class="card">
                    <div class="card-header bg-white text-white">
                        <h4 class="mb-0"><i class="fas fa-file-alt me-2"></i>Documentos Aprovados e Disponíveis</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            Estes documentos já passaram pelo processo de aprovação e estão disponíveis para visualização.
                        </div>
                        
                        <div class="filters-container mb-4">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-filter"></i></span>
                                        <select class="form-control" id="group-filter">
                                            <option value="all">Todos os Grupos</option>
                                            <option value="GESTÃO CORPORATIVA">GESTÃO CORPORATIVA</option>
                                            <option value="SUZANO UNBC">SUZANO UNBC</option>
                                            <option value="SUZANO UNPE">SUZANO UNPE</option>
                                            <option value="SAINT GOBAIN">SAINT GOBAIN</option>
                                            <option value="JOHN DEERE">JOHN DEERE</option>
                                            <option value="OUTROS">OUTROS</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-sitemap"></i></span>
                                        <select class="form-control" id="subgroup-filter">
                                            <option value="all">Todos os Subgrupos</option>
                                            <!-- Subgrupos serão carregados dinamicamente -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" id="search-input" class="form-control" 
                                            placeholder="Pesquisar por nome, grupo ou subgrupo...">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-md-12">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <span class="badge bg-success" id="document-count">0 documentos</span>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-outline-secondary" id="refresh-btn">
                                                <i class="fas fa-sync-alt me-1"></i> Atualizar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="documents-container">
                            <div class="empty-state">
                                <i class="fas fa-folder-open fa-3x mb-3"></i>
                                <h5>Nenhum documento encontrado</h5>
                                <p>Não há procedimentos operacionais aprovados ainda.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de Confirmação de Exclusão -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Exclusão</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja excluir este documento? Esta ação não pode ser desfeita.</p>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Esta ação removerá permanentemente o documento do sistema.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn">
                        <i class="fas fa-trash me-1"></i> Excluir Permanentemente
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Visualização do Documento -->
    <div class="modal fade" id="documentViewerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title document-viewer-title" id="documentViewerTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="document-info mb-3">
                        <div class="row">
                            <div class="col-md-6">
                                <small class="text-muted" id="documentInfo"></small>
                            </div>
                            <div class="col-md-6 text-end">
                                <span class="badge bg-success" id="documentStatusBadge">Aprovado</span>
                            </div>
                        </div>
                    </div>
                    <iframe id="documentViewerIframe" class="document-viewer-iframe" 
                        style="width:100%; height:70vh; border:none; border-radius: 5px;"></iframe>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> Fechar
                    </button>
                    <button type="button" class="btn btn-primary" id="downloadFromViewerBtn">
                        <i class="fas fa-download me-1"></i> Baixar Documento
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <script src="../js/auth.js"></script>
    
    <script>
        // ============================================
        // VARIÁVEIS GLOBAIS
        // ============================================
        let currentUser = null;
        let isGestaoCorp = false;
        let isAprovador1 = false;
        let isAprovadorFinal = false;
        let deleteDocId = null;
        let currentViewingDocId = null;
        let confirmModal = null;
        let documentViewerModal = null;
        let allDocuments = [];
        let statsInterval = null;

        // ============================================
        // CONFIGURAÇÃO DE SUBGRUPOS
        // ============================================
        const allSubgroups = [
            'gestão corp',
            'CD SUZANLOG',
            'CDR SUZANO',
            'CD SUZANO MARACANAU',
            'CD SUZANO SERRA',
            'CD SUZANO SÃO JOSE DOS PINHAIS',
            'CD SUZANO CARIACICA',
            'CD TRIANGULO',
            'CD TSUZUKI',
            'CD YAMAHA SÃO PAULO',
            'FABRICA AHLSTROM JACAREÍ',
            'FABRICA BOSTIK SÃO ROQUE',
            'FABRICA IMERYS CACHOEIRO DO ITAPEMIRIM',
            'FABRICA IMERYS LIMEIRA',
            'FABRICA JOHN DEREE HORIZONTINA',
            'FABRICA JOHN DEREE INDAIATUBA',
            'FABRICA JOHN DEREE MONTENEGRO',
            'FABRICA JOHN DEREE CATALÃO',
            'FABRICA JOHN DEREE CAMPINAS',
            'FABRICA NITERRA MOGI DAS CRUZES',
            'FABRICA OJI PAPEIS PIRACICABA',
            'FABRICA PLACO MOGI DAS CRUZES',
            'FABRICA SUZANO SUZANO',
            'FABRICA SUZANO RIO VERDE',
            'FABRICA WHITE MARTINS JACAREÍ',
            'FABRICA SUZANO ARACRUZ',
            'FABRICA SUZANO BELEM',
            'FABRICA SUZANO IMPERATRIZ',
            'FABRICA SUZANO JACAREÍ',
            'FABRICA SUZANO LIMEIRA',
            'FABRICA QUARTZOLIT CAMAÇARI',
            'FABRICA QUARTZOLIT JANDIRA',
            'FABRICA QUARTZOLIT MOGI DAS CRUZES',
            'FABRICA SUZANO MOGI DAS CRUZES',
            'FABRICA IBEMA'
        ];

        const subgroupMapping = {
            'GESTÃO CORPORATIVA': allSubgroups,
            'SUZANO UNBC': [
                'CD SUZANO MARACANAU',
                'CD SUZANO CARIACICA',
                'FABRICA SUZANO ARACRUZ',
                'FABRICA SUZANO BELEm',
                'FABRICA SUZANO IMPERATRIZ',
                'FABRICA SUZANO MOGI DAS CRUZES'
            ],
            'SUZANO UNPE': [
                'FABRICA SUZANO LIMEIRA',
                'FABRICA SUZANO SUZANO',
                'CDR SUZANO',
                'FABRICA SUZANO RIO VERDE',
                'CD SUZANO SÃO JOSE DOS PINHAIS',
                'CD CHAPECO'
            ],
            'SAINT GOBAIN': [
                'FABRICA PLACO MOGI DAS CRUZES',
                'FABRICA QUARTZOLIT CAMAÇARI',
                'FABRICA QUARTZOLIT JANDIRA'
            ],
            'JOHN DEERE': [
                'FABRICA JOHN DEREE HORIZONTINA',
                'FABRICA JOHN DEREE INDAIATUBA',
                'FABRICA JOHN DEREE MONTENEGRO',
                'FABRICA JOHN DEREE CATALÃO',
                'FABRICA JOHN DEREE CAMPINAS'
            ]
        };

        subgroupMapping['OUTROS'] = allSubgroups.filter(subgroup =>
            !Object.entries(subgroupMapping)
                .filter(([grupo]) => grupo !== 'GESTÃO CORPORATIVA')
                .flatMap(([, unidades]) => unidades)
                .includes(subgroup)
        );

        // ============================================
        // INICIALIZAÇÃO DA PÁGINA
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM carregado - Inicializando página...');
            
            setupHamburgerMenu();
            setupGroupListeners();
            initializeSubgroups();
            
            auth.onAuthStateChanged(user => {
                if (user) {
                    console.log('Usuário autenticado:', user.email);
                    currentUser = user;
                    loadUserData(user);
                    checkUserPermissions(user);
                    loadDocuments();
                    loadStatistics();
                    // Atualizar estatísticas a cada 30 segundos
                    statsInterval = setInterval(loadStatistics, 30000);
                } else {
                    console.log('Usuário não autenticado - redirecionando...');
                    window.location.href = 'index.html';
                }
            });

            const uploadForm = document.getElementById('upload-form');
            if (uploadForm) {
                uploadForm.addEventListener('submit', handleUpload);
            }

            const logoutBtn = document.getElementById('sidebar-logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logoutUser);
            }

            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', filterDocuments);
            }

            const groupFilter = document.getElementById('group-filter');
            if (groupFilter) {
                groupFilter.addEventListener('change', function() {
                    updateSubgroupOptions(this.value, 'filter');
                    filterDocuments();
                });
            }

            const subgroupFilter = document.getElementById('subgroup-filter');
            if (subgroupFilter) {
                subgroupFilter.addEventListener('change', filterDocuments);
            }

            const refreshBtn = document.getElementById('refresh-btn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    loadDocuments();
                    loadStatistics();
                    showToast('Dados atualizados com sucesso!', 'success');
                });
            }

            const confirmModalElement = document.getElementById('confirmModal');
            if (confirmModalElement) {
                confirmModal = new bootstrap.Modal(confirmModalElement);
            }
            
            const documentViewerModalElement = document.getElementById('documentViewerModal');
            if (documentViewerModalElement) {
                documentViewerModal = new bootstrap.Modal(documentViewerModalElement);
            }

            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            if (confirmDeleteBtn) {
                confirmDeleteBtn.addEventListener('click', function() {
                    if (deleteDocId) {
                        deleteDocument(deleteDocId);
                        confirmModal.hide();
                    }
                });
            }

            const downloadFromViewerBtn = document.getElementById('downloadFromViewerBtn');
            if (downloadFromViewerBtn) {
                downloadFromViewerBtn.addEventListener('click', function() {
                    if (currentViewingDocId) {
                        downloadDocument(currentViewingDocId);
                    }
                });
            }
        });

        // ============================================
        // FUNÇÕES DE CONFIGURAÇÃO
        // ============================================
        function setupHamburgerMenu() {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                    overlay.classList.toggle('active');
                    this.classList.toggle('active');
                });
                
                if (overlay) {
                    overlay.addEventListener('click', function() {
                        sidebar.classList.remove('active');
                        this.classList.remove('active');
                        if (sidebarToggle) sidebarToggle.classList.remove('active');
                    });
                }
            }
        }

        function setupGroupListeners() {
            const uploadGroup = document.getElementById('document-group');
            if (uploadGroup) {
                uploadGroup.addEventListener('change', function() {
                    updateSubgroupOptions(this.value, 'upload');
                });
            }
        }

        // ============================================
        // FUNÇÕES DE SUBGRUPOS
        // ============================================
        function initializeSubgroups() {
            console.log('Inicializando subgrupos...');
            
            const filterSubgroup = document.getElementById('subgroup-filter');
            if (filterSubgroup) {
                filterSubgroup.innerHTML = '<option value="all">Todos os Subgrupos</option>';
                allSubgroups.forEach(subgroup => {
                    const option = document.createElement('option');
                    option.value = subgroup;
                    option.textContent = subgroup;
                    filterSubgroup.appendChild(option);
                });
            }
            
            const uploadSubgroup = document.getElementById('document-subgroup-upload');
            if (uploadSubgroup) {
                uploadSubgroup.innerHTML = '<option value="">Selecione um subgrupo</option>';
            }
        }

        function updateSubgroupOptions(group, type = 'filter') {
            let selectElement;
            if (type === 'upload') {
                selectElement = document.getElementById('document-subgroup-upload');
            } else {
                selectElement = document.getElementById('subgroup-filter');
            }
            
            if (!selectElement) return;
            
            const currentValue = selectElement.value;
            
            if (type === 'upload') {
                selectElement.innerHTML = '<option value="">Selecione um subgrupo</option>';
            } else {
                selectElement.innerHTML = '<option value="all">Todos os Subgrupos</option>';
            }
            
            if (!group || group === 'all' || group === '') {
                allSubgroups.forEach(subgroup => {
                    const option = document.createElement('option');
                    option.value = subgroup;
                    option.textContent = subgroup;
                    selectElement.appendChild(option);
                });
            } else if (subgroupMapping[group]) {
                subgroupMapping[group].forEach(subgroup => {
                    const option = document.createElement('option');
                    option.value = subgroup;
                    option.textContent = subgroup;
                    selectElement.appendChild(option);
                });
            } else {
                allSubgroups.forEach(subgroup => {
                    const option = document.createElement('option');
                    option.value = subgroup;
                    option.textContent = subgroup;
                    selectElement.appendChild(option);
                });
            }
            
            if (currentValue && Array.from(selectElement.options).some(opt => opt.value === currentValue)) {
                selectElement.value = currentValue;
            }
            
            if (type === 'filter') {
                selectElement.dispatchEvent(new Event('change'));
            }
        }

        // ============================================
        // FUNÇÕES DE USUÁRIO
        // ============================================
        function loadUserData(user) {
            db.collection('users').doc(user.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        const userNameElement = document.getElementById('sidebar-user-name');
                        const userUnitElement = document.getElementById('sidebar-user-unit');
                        
                        if (userNameElement) {
                            userNameElement.textContent = userData.name || 'Usuário';
                        }
                        if (userUnitElement) {
                            userUnitElement.textContent = userData.unit || 'Não definida';
                        }
                    }
                })
                .catch(error => {
                    console.error('Erro ao carregar dados do usuário:', error);
                });
        }

        function checkUserPermissions(user) {
            db.collection('users').doc(user.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        isGestaoCorp = userData.unit && userData.unit.toLowerCase() === 'gestão corp';
                        
                        // Verificar se é aprovador 1
                        isAprovador1 = userData.role && (
                            userData.role.toLowerCase().includes('aprovador1') ||
                            userData.role.toLowerCase().includes('gestor') ||
                            userData.unit.toLowerCase() === 'gestão corp'
                        );
                        
                        // Verificar se é aprovador final
                        isAprovadorFinal = userData.role && (
                            userData.role.toLowerCase().includes('aprovadorfinal') ||
                            userData.role.toLowerCase().includes('diretor') ||
                            userData.role.toLowerCase().includes('gerente')
                        );

                        if (isGestaoCorp) {
                            const uploadSection = document.getElementById('upload-section');
                            if (uploadSection) {
                                uploadSection.style.display = 'block';
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('Erro ao verificar permissões:', error);
                });
        }

        // ============================================
        // FUNÇÕES DE ESTATÍSTICAS
        // ============================================
        function loadStatistics() {
            // Contar documentos aprovados
            db.collection('procedimentos_operacionais').get()
                .then(snapshot => {
                    document.getElementById('count-aprovados').textContent = snapshot.size;
                })
                .catch(error => {
                    console.error('Erro ao contar documentos aprovados:', error);
                });
            
            // Contar documentos pendentes no Aprovador 1
            db.collection('procedimentos_pendentes_aprovador1')
                .where('status', '==', 'pendente')
                .get()
                .then(snapshot => {
                    const count = snapshot.size;
                    document.getElementById('count-pendentes-1').textContent = count;
                    document.getElementById('badge-aprovador1').textContent = count;
                    
                    // Mostrar/ocultar badge
                    const badge1 = document.getElementById('badge-aprovador1');
                    if (count > 0) {
                        badge1.style.display = 'flex';
                    } else {
                        badge1.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Erro ao contar documentos pendentes aprovador 1:', error);
                });
            
            // Contar documentos pendentes no Aprovador Final
            db.collection('procedimentos_pendentes_aprovador_final')
                .where('status', '==', 'pendente_aprovador_final')
                .get()
                .then(snapshot => {
                    const count = snapshot.size;
                    document.getElementById('count-pendentes-final').textContent = count;
                    document.getElementById('badge-aprovador-final').textContent = count;
                    
                    // Mostrar/ocultar badge
                    const badgeFinal = document.getElementById('badge-aprovador-final');
                    if (count > 0) {
                        badgeFinal.style.display = 'flex';
                    } else {
                        badgeFinal.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Erro ao contar documentos pendentes aprovador final:', error);
                });
            
            // Contar documentos rejeitados
            db.collection('procedimentos_rejeitados').get()
                .then(snapshot => {
                    document.getElementById('count-rejeitados').textContent = snapshot.size;
                })
                .catch(error => {
                    console.error('Erro ao contar documentos rejeitados:', error);
                });
        }

        // ============================================
        // FUNÇÕES DE DOCUMENTOS
        // ============================================
        function loadDocuments() {
            const container = document.getElementById('documents-container');
            if (!container) return;
            
            container.innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-3">Carregando documentos...</p>
                </div>
            `;

            db.collection('procedimentos_operacionais').orderBy('aprovadoEm', 'desc').get()
                .then(querySnapshot => {
                    allDocuments = [];

                    if (querySnapshot.empty) {
                        container.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-folder-open fa-3x mb-3"></i>
                                <h5>Nenhum documento encontrado</h5>
                                <p>Não há procedimentos operacionais aprovados ainda.</p>
                                ${isGestaoCorp ? `
                                <button class="btn btn-primary mt-3" onclick="document.getElementById('upload-section').scrollIntoView()">
                                    <i class="fas fa-upload me-2"></i>Enviar Primeiro Documento
                                </button>
                                ` : ''}
                            </div>
                        `;
                        updateDocumentCount(0);
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        allDocuments.push({
                            id: doc.id,
                            ...data
                        });
                    });

                    renderDocuments(allDocuments);
                    updateDocumentCount(allDocuments.length);
                })
                .catch(error => {
                    console.error('Erro ao carregar documentos:', error);
                    container.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Erro ao carregar documentos. Tente novamente.
                            <button class="btn btn-sm btn-outline-danger ms-2" onclick="loadDocuments()">
                                <i class="fas fa-redo"></i>
                            </button>
                        </div>
                    `;
                });
        }

        function renderDocuments(documents) {
            const container = document.getElementById('documents-container');

            if (documents.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search fa-3x mb-3"></i>
                        <h5>Nenhum documento encontrado</h5>
                        <p>Não há documentos que correspondam aos filtros selecionados.</p>
                    </div>
                `;
                return;
            }

            const list = document.createElement('div');
            list.className = 'document-list';

            documents.forEach((doc, index) => {
                const card = document.createElement('div');
                card.className = 'document-card fade-in';
                card.style.animationDelay = `${index * 0.05}s`;
                
                const fileIcon = getFileIcon(doc.fileName || doc.type);
                const formattedDate = formatDate(doc.aprovadoEm || doc.createdAt);
                const fileSize = doc.size ? formatFileSize(doc.size) : 'Tamanho não disponível';
                
                card.innerHTML = `
                    <div class="document-header">
                        <div class="d-flex align-items-center gap-3">
                            <div class="document-icon">
                                <i class="${fileIcon} fa-2x" style="color: #dc3545;"></i>
                            </div>
                            <div class="document-title-wrapper">
                                <div class="document-title">${doc.title || 'Documento sem título'}</div>
                                <div class="d-flex align-items-center gap-2 mt-1">
                                    <span class="document-version">v1.0</span>
                                    <span class="document-status status-aprovado">
                                        <i class="fas fa-check-circle"></i> Aprovado
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="document-badges">
                            <span class="badge bg-primary">${doc.group || 'Sem grupo'}</span>
                            ${doc.subgroup ? `<span class="badge bg-secondary">${doc.subgroup}</span>` : ''}
                        </div>
                    </div>
                    <div class="document-meta">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="document-meta-item">
                                    <i class="fas fa-calendar-check text-primary"></i>
                                    <span><strong>Aprovado em:</strong> ${formattedDate}</span>
                                </div>
                                <div class="document-meta-item">
                                    <i class="fas fa-user text-primary"></i>
                                    <span><strong>Enviado por:</strong> ${doc.uploadedByName || 'Usuário'}</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="document-meta-item">
                                    <i class="fas fa-file-pdf text-primary"></i>
                                    <span><strong>Tipo:</strong> PDF</span>
                                </div>
                                <div class="document-meta-item">
                                    <i class="fas fa-weight-hanging text-primary"></i>
                                    <span><strong>Tamanho:</strong> ${fileSize}</span>
                                </div>
                            </div>
                        </div>
                        ${doc.aprovadorFinalName ? `
                        <div class="document-meta-item mt-2">
                            <i class="fas fa-user-shield text-success"></i>
                            <span><strong>Aprovador Final:</strong> ${doc.aprovadorFinalName}</span>
                        </div>
                        ` : ''}
                    </div>
                    ${doc.observacoes ? `
                    <div class="observacoes-box">
                        <strong><i class="fas fa-comment me-1"></i>Observações:</strong>
                        <p class="mb-0">${doc.observacoes}</p>
                    </div>
                    ` : ''}
                    <div class="action-buttons">
                        <button class="btn btn-outline-primary btn-sm document-action-btn" data-id="${doc.id}" title="Visualizar documento">
                            <i class="fas fa-eye me-1"></i> Visualizar
                        </button>
                        <button class="btn btn-outline-success btn-sm document-action-btn" data-id="${doc.id}" title="Baixar documento">
                            <i class="fas fa-download me-1"></i> Baixar
                        </button>
                        ${isGestaoCorp ? `
                        <button class="btn btn-outline-danger btn-sm document-action-btn" data-id="${doc.id}" title="Excluir documento">
                            <i class="fas fa-trash me-1"></i> Excluir
                        </button>
                        ` : ''}
                    </div>
                `;
                list.appendChild(card);
            });

            container.innerHTML = '';
            container.appendChild(list);
            assignButtonEvents();
        }

        function updateDocumentCount(count) {
            const countElement = document.getElementById('document-count');
            if (countElement) {
                countElement.textContent = `${count} documento${count !== 1 ? 's' : ''}`;
            }
        }

        function assignButtonEvents() {
            document.querySelectorAll('.btn-outline-primary').forEach(btn => {
                if (btn.classList.contains('document-action-btn')) {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const docId = this.getAttribute('data-id');
                        viewDocument(docId);
                    });
                }
            });
            
            document.querySelectorAll('.btn-outline-success').forEach(btn => {
                if (btn.classList.contains('document-action-btn')) {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const docId = this.getAttribute('data-id');
                        downloadDocument(docId);
                    });
                }
            });
            
            if (isGestaoCorp) {
                document.querySelectorAll('.btn-outline-danger').forEach(btn => {
                    if (btn.classList.contains('document-action-btn')) {
                        btn.addEventListener('click', function(e) {
                            e.preventDefault();
                            deleteDocId = this.getAttribute('data-id');
                            confirmModal.show();
                        });
                    }
                });
            }
        }

        function filterDocuments() {
            const searchText = document.getElementById('search-input').value.toLowerCase();
            const groupFilter = document.getElementById('group-filter').value;
            const subgroupFilter = document.getElementById('subgroup-filter').value;
            
            const filteredDocs = allDocuments.filter(doc => {
                const matchesGroup = groupFilter === 'all' || doc.group === groupFilter;
                const matchesSubgroup = subgroupFilter === 'all' || doc.subgroup === subgroupFilter;
                const matchesSearch = !searchText || 
                    (doc.title && doc.title.toLowerCase().includes(searchText)) ||
                    (doc.group && doc.group.toLowerCase().includes(searchText)) ||
                    (doc.subgroup && doc.subgroup.toLowerCase().includes(searchText)) ||
                    (doc.uploadedByName && doc.uploadedByName.toLowerCase().includes(searchText));
                
                return matchesGroup && matchesSubgroup && matchesSearch;
            });
            
            renderDocuments(filteredDocs);
            updateDocumentCount(filteredDocs.length);
        }

        // ============================================
        // FUNÇÕES DE UPLOAD PARA APROVAÇÃO
        // ============================================
        function handleUpload(e) {
            e.preventDefault();

            const title = document.getElementById('document-title').value.trim();
            const group = document.getElementById('document-group').value;
            const subgroup = document.getElementById('document-subgroup-upload').value;
            const file = document.getElementById('document-file').files[0];
            const observations = document.getElementById('document-observations').value.trim();

            if (!title || !group || !subgroup || !file) {
                showToast('Preencha todos os campos obrigatórios', 'warning');
                return;
            }

            if (file.size > 10 * 1024 * 1024) { // 10MB
                showToast('O arquivo é muito grande. Tamanho máximo: 10MB', 'warning');
                return;
            }

            if (file.type !== 'application/pdf') {
                showToast('Apenas arquivos PDF são permitidos', 'warning');
                return;
            }

            const uploadBtn = document.getElementById('upload-btn');
            const progress = document.getElementById('upload-progress');
            const progressBar = progress?.querySelector('.progress-bar');
            
            if (uploadBtn) {
                uploadBtn.disabled = true;
                uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Enviando...';
            }
            
            if (progress) {
                progress.style.display = 'block';
            }
            
            if (progressBar) {
                progressBar.style.width = '0%';
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const fileBase64 = event.target.result;

                let progressValue = 0;
                const progressInterval = setInterval(() => {
                    progressValue += 10;
                    if (progressBar) {
                        progressBar.style.width = `${progressValue}%`;
                    }
                    
                    if (progressValue >= 100) {
                        clearInterval(progressInterval);
                        
                        const historicoItem = {
                            acao: 'enviado',
                            usuario: currentUser.displayName || currentUser.email,
                            data: new Date(),
                            observacoes: observations
                        };
                        
                        db.collection('procedimentos_pendentes_aprovador1').add({
                            title: title,
                            group: group,
                            subgroup: subgroup,
                            arquivoBase64: fileBase64,
                            fileName: file.name,
                            type: file.type,
                            size: file.size,
                            uploadedBy: currentUser.uid,
                            uploadedByName: currentUser.displayName || currentUser.email,
                            observacoes: observations,
                            status: 'pendente',
                            createdAt: new Date(),
                            historico: [historicoItem]
                        })
                        .then((docRef) => {
                            if (uploadBtn) {
                                uploadBtn.disabled = false;
                                uploadBtn.innerHTML = '<i class="fas fa-upload me-2"></i>Enviar para Aprovação';
                            }
                            
                            if (progress) {
                                progress.style.display = 'none';
                            }
                            
                            if (progressBar) {
                                progressBar.style.width = '0%';
                            }
                            
                            const uploadForm = document.getElementById('upload-form');
                            if (uploadForm) {
                                uploadForm.reset();
                                updateSubgroupOptions('', 'upload');
                            }
                            
                            showToast('Documento enviado para aprovação com sucesso!', 'success');
                            loadStatistics();
                            
                            // Scroll para mostrar o status
                            document.querySelector('.dashboard-cards').scrollIntoView({
                                behavior: 'smooth'
                            });
                        })
                        .catch(error => {
                            console.error('Erro ao salvar documento:', error);
                            showToast('Erro ao salvar informações do documento', 'error');
                            
                            if (uploadBtn) {
                                uploadBtn.disabled = false;
                                uploadBtn.innerHTML = '<i class="fas fa-upload me-2"></i>Enviar para Aprovação';
                            }
                            
                            if (progress) {
                                progress.style.display = 'none';
                            }
                            
                            if (progressBar) {
                                progressBar.style.width = '0%';
                            }
                        });
                    }
                }, 100);
            };

            reader.onerror = function(error) {
                console.error('Erro ao ler arquivo:', error);
                showToast('Erro ao ler o arquivo. Tente novamente.', 'error');
                
                if (uploadBtn) {
                    uploadBtn.disabled = false;
                    uploadBtn.innerHTML = '<i class="fas fa-upload me-2"></i>Enviar para Aprovação';
                }
                
                if (progress) {
                    progress.style.display = 'none';
                }
            };

            reader.readAsDataURL(file);
        }

        // ============================================
        // FUNÇÕES DE MANIPULAÇÃO DE DOCUMENTOS
        // ============================================
        function viewDocument(docId) {
            currentViewingDocId = docId;
            
            db.collection('procedimentos_operacionais').doc(docId).get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        const title = data.title || 'Visualização do Documento';
                        const formattedDate = formatDate(data.aprovadoEm || data.createdAt);
                        
                        document.getElementById('documentViewerTitle').textContent = title;
                        document.getElementById('documentInfo').textContent = 
                            `Enviado por: ${data.uploadedByName || 'Usuário'} | Aprovado em: ${formattedDate}`;
                        
                        // Configurar visualizador PDF
                        const pdfUrl = data.arquivoBase64;
                        document.getElementById('documentViewerIframe').src = pdfUrl;
                        
                        documentViewerModal.show();
                    } else {
                        showToast('Documento não encontrado', 'warning');
                    }
                })
                .catch(error => {
                    console.error('Erro ao carregar documento:', error);
                    showToast('Erro ao abrir o documento para visualização', 'error');
                });
        }

        function deleteDocument(docId) {
            db.collection('procedimentos_operacionais').doc(docId).delete()
                .then(() => {
                    loadDocuments();
                    loadStatistics();
                    showToast('Documento excluído com sucesso!', 'success');
                })
                .catch(error => {
                    console.error('Erro ao excluir documento:', error);
                    showToast('Erro ao excluir documento', 'error');
                });
        }

        function downloadDocument(docId) {
            db.collection('procedimentos_operacionais').doc(docId).get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        const link = document.createElement('a');
                        link.href = data.arquivoBase64;
                        link.download = data.fileName || 'documento.pdf';
                        link.style.display = 'none';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        showToast('Download iniciado', 'success');
                    } else {
                        showToast('Documento não encontrado', 'warning');
                    }
                })
                .catch(error => {
                    console.error('Erro ao baixar documento:', error);
                    showToast('Erro ao baixar o documento', 'error');
                });
        }

        // ============================================
        // FUNÇÕES AUXILIARES
        // ============================================
        function getFileIcon(fileName) {
            if (!fileName) return 'fas fa-file-pdf';
            
            const extension = fileName.split('.').pop().toLowerCase();
            const iconMap = {
                'pdf': 'fas fa-file-pdf'
            };
            
            return iconMap[extension] || 'fas fa-file-pdf';
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'Data não disponível';
            try {
                let date;
                
                // Se for um Firestore Timestamp
                if (timestamp.toDate && typeof timestamp.toDate === 'function') {
                    date = timestamp.toDate();
                }
                // Se já for um objeto Date
                else if (timestamp instanceof Date) {
                    date = timestamp;
                }
                // Se for uma string
                else if (typeof timestamp === 'string') {
                    date = new Date(timestamp);
                }
                // Se for um número
                else if (typeof timestamp === 'number') {
                    date = new Date(timestamp);
                }
                else {
                    return 'Data inválida';
                }
                
                if (isNaN(date.getTime())) {
                    return 'Data inválida';
                }
                
                return date.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                console.error('Erro ao formatar data:', error);
                return 'Data inválida';
            }
        }

        function formatFileSize(bytes) {
            if (!bytes || bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showToast(message, type = 'info') {
            // Criar toast container se não existir
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.style.position = 'fixed';
                toastContainer.style.top = '20px';
                toastContainer.style.right = '20px';
                toastContainer.style.zIndex = '9999';
                document.body.appendChild(toastContainer);
            }
            
            const toastId = 'toast-' + Date.now();
            const bgColor = type === 'success' ? 'bg-success' : 
                           type === 'error' ? 'bg-danger' : 
                           type === 'warning' ? 'bg-warning' : 'bg-info';
            
            const toastHtml = `
                <div id="${toastId}" class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header ${bgColor} text-white">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                      type === 'error' ? 'exclamation-circle' : 
                                      type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                        <strong class="me-auto">${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('afterbegin', toastHtml);
            
            // Remover toast após 5 segundos
            setTimeout(() => {
                const toast = document.getElementById(toastId);
                if (toast) {
                    toast.remove();
                }
            }, 5000);
        }

        function logoutUser() {
            if (statsInterval) {
                clearInterval(statsInterval);
            }
            
            auth.signOut().then(() => {
                window.location.href = 'index.html';
            }).catch(error => {
                console.error('Erro ao fazer logout:', error);
                showToast('Erro ao fazer logout. Tente novamente.', 'error');
            });
        }
    </script>
</body>
</html>